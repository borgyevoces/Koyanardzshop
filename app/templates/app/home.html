{% extends 'app/navigation.html' %}
{% load static %}
{% load humanize %}

{% block content %}

<div class="homepage">
    <div class="home">
        <div class="hometext">
            <div class="hometext_upper">
                <p class="hometextupper_p">POWERED <span class="hometextupper_span">by</span><p>
                <p>Passion</p>
                <p class="hometextupper_p">DRIVEN <span>by</span><p>
                <p>Performance</p>
            </div>
            <div class="hometext_bottom">
                <p>Discover affordable and high-performance computers, laptops, and custom PC builds--handpicked to meet your needs.</p>
            </div>
            <div class="hometext_button">
                <a href="{% url 'product' %}">
                    <p>Buy Now</p>
                </a>
                
            </div>
        </div>
        <div class="homeimages">
            <img src="{% static 'images/system1drop.png' %}" alt="">
        </div>
    </div>
    <div class="home_newproducts">
        <h3>What's New?</h3>
        <div class="home_newupper">
            <a href="{% url 'product' %}">See more...</a>
        </div>
        <div class="product-container">
        {% if products %}
            {% for produkto in products %}
            <div class="product-card">
                <button class="favorite_btn {% if produkto.id|stringformat:'s' in request.session.favorites %}favorited{% endif %}" data-product-id="{{ produkto.id }}" id="homefavorites"><img src="{% static 'images/icon/heart-black.png' %}" alt=""></button>
                {% if produkto.image %}
                <a href="{% url 'product_item' produkto.id %}">
                    <img src="{{ produkto.image.url }}" alt="Product Image">
                </a>
                {% endif %}
                <div class="product-name">
                    <h4>{{ produkto.product_name }}</h4>
                    <p>₱{{ produkto.price|intcomma }}</p>
                    <div class="productcard-button">
                        <form action="{% url 'add_to_cart' produkto.id %}" method="POST">
                            {% csrf_token %}
                            <button>Add to Cart</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% endif %}
        </div>
    </div>
    <div class="home_sell">
        <div class="homesell_left">
            <img src="{% static 'images/computer.png' %}" alt="No image">
        </div>
        <div class="homesell_right">
            <div class="sellright_upper">
                <h4>Got a laptop or PC to Sell?</h4>
            </div>
            <div class="sellright_body">
                <p>Turn your old tech into cash or trade it in for an upgrade! Schedule an appointment and let us evaluate your device in-store.</p>
            </div>
            <div class="sellright_button">
                <a href="{% url 'selling' %}">
                    <p>Sell Now</p>
                </a>
            </div>
        </div>
    </div>
    <div class="home_about">
        <div class="homeabout_body">
            <div class="homeabout_left">
                <h4>About Us</h4>
                <div class="aboutleft_text">        
                    <p>Koya Nardz Computer Trading is a trusted tech shop in Bacoor, Cavite, offering brand-new and secondhand laptops, desktops, and PC parts. Since 2016, we’ve served students, profprofessionals, and businesses with reliable, tested and budget-friendly computer products. with a passing for technology and customer service, we help every customer find the setup that fits their needs.</p>
                </div>
                <div class="aboutleft_bottom">
                    <p>Find us here</p>
                    <img src="{% static 'images/maps.png' %}" alt="">
                </div>
            </div>
            <div class="homeabout_right">
                <img src="{% static 'images/KNCT.png' %}" alt="">
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.favorite_btn').forEach(function (btn) {
        btn.addEventListener('click', function () {
            const productId = this.getAttribute('data-product-id');

            fetch(`/toggle_favorite/${productId}/`, {
                method: 'GET',
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'added') {
                    this.classList.add('favorited');
                } else if (data.status === 'removed') {
                    this.classList.remove('favorited');

                    const card = this.closest('.favorites');
                    if (card) card.remove(); 
                }
            })
            .catch(err => console.error('Error toggling favorite:', err));
        });
    });
});
</script>
{% endblock content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Koya Nardz Computer Trading{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Afacad:ital,wght@0,400..700;1,400..700&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <script src="{% static 'js/base.js' %}"></script>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>

    <header class="site-header">
        <div class="header-inner container">
            <a class="brand-link" href="{% url 'home' %}">
                <img src="{% static 'images/LOGO.png' %}" alt="Koya Nardz" class="brand-logo">
                <div class="brand-text">
                    <span class="brand-title">Koya Nardz</span>
                    <small class="brand-sub">Computer Trading</small>
                </div>
            </a>

            <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
                <span class="hamburger"></span>
            </button>

            <nav class="main-nav" aria-label="Primary navigation" style="text-transform: uppercase;">
                <ul class="nav-list" style="text-transform: uppercase;">
                    <li><a href="{% url 'product' %}"><span>Products</span></a></li>
                    <li class="has-sub">
                        <a href="{% url 'selling_information' %}"><span>Trade</span></a>
                    </li>
                    <li><a href="{% url 'my_appointment' %}"><span>Appointment</span></a></li>
                        <!-- Mobile-only action links: cart, favorites, account/sign-in -->
                        <li class="nav-actions-mobile"><a href="{% url 'cart' %}"><i class="fa-solid fa-cart-shopping" aria-hidden="true"></i><span>Cart</span></a></li>
                        <li class="nav-actions-mobile"><button id="favToggleMobile" class="action-btn-mobile"><i class="fa-regular fa-heart" aria-hidden="true"></i><span>Favorites</span></button></li>
                        <li class="nav-actions-mobile">{% if user.is_authenticated %}<a href="{% url 'logout' %}" class="action-btn-mobile"><i class="fa-solid fa-right-from-bracket" aria-hidden="true"></i><span>Logout</span></a>{% else %}<a href="{% url 'login' %}" class="action-btn-mobile"><i class="fa-solid fa-right-to-bracket" aria-hidden="true"></i><span>Sign in</span></a>{% endif %}</li>
                </ul>
            </nav>

            <div class="header-actions">
                <a class="action-btn" href="{% url 'cart' %}" title="Cart"><i class="fa-solid fa-cart-shopping" aria-hidden="true"></i></a>

                <div class="dropdown favorite-dropdown">
                    <button id="favToggle" class="action-btn" aria-haspopup="true" aria-expanded="false"><i class="fa-regular fa-heart" aria-hidden="true"></i></button>
                    <div id="favoriteDropdown" class="dropdown-panel">
                        {% if products_favorite %}
                            {% for produkto in products_favorite %}
                            <div class="fav-item" data-product-id="{{ produkto.id }}">
                                <a href="{% url 'product_item' produkto.id %}"><img src="{{ produkto.image.url }}" width="40" height="40" alt="{{ produkto.product_name }}"></a>
                                <div class="fav-meta">{{ produkto.product_name }}</div>
                                <div class="fav-actions">
                                    <button type="button" class="fav-remove-btn" data-product-id="{{ produkto.id }}" aria-label="Remove from favorites"><i class="fa-solid fa-trash" aria-hidden="true"></i></button>
                                    <form action="{% url 'add_to_cart' produkto.id %}" method="POST">{% csrf_token %}<button>ðŸ›’</button></form>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="no-fav">No favorites yet</p>
                        {% endif %}
                    </div>
                </div>

                <div class="dropdown user-dropdown">
                    {% if user.is_authenticated %}
                        <button id="userToggle" class="action-btn"><i class="fa-solid fa-user" aria-hidden="true"></i></button>
                        <div id="userDropdown" class="dropdown-panel">
                            <div class="user-card">
                                {% if user.avatar %}
                                    <img src="{{ user.avatar.url }}" alt="{{ user.username }}" class="avatar-img">
                                {% else %}
                                    <img src="{% static 'images/icon/user_default.png' %}" alt="{{ user.username }}" class="avatar-img">
                                {% endif %}
                                <div class="user-info">{{ user.username }}</div>
                            </div>
                            <a href="{% url 'profile' %}">Profile</a>
                            <a href="{% url 'logout' %}">Logout</a>
                        </div>
                    {% else %}
                        <a class="action-btn" href="{% url 'login' %}"><i class="fa-solid fa-right-to-bracket" aria-hidden="true"></i></a>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    <main class="content-wrapper">{% block content %}{% endblock %}</main>

    <footer class="site-footer">
        <div class="footer-inner container">
            <div class="footer-col footer-about">
                <h4>About</h4>
                <p>Koya Nardz Computer Trading â€” trusted tech shop since 2016. New and secondhand laptops, desktops, and PC parts.</p>
                <div class="socials">
                    <a href="https://www.facebook.com/KOYANARDZGAMIN?log_join_id=94609efe-f6a2-435e-bff9-cbee4b2df289" class="social" aria-label="Facebook"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>
                    <a href="instagram://user/?username=knctrading&igsh=MTBnZ2Z2eTdyemxzbw%3D%3D" class="social" aria-label="Instagram"><i class="fab fa-instagram" aria-hidden="true"></i></a>
                    <a href="#" class="social" aria-label="Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
                </div>
            </div>
            <div class="footer-col footer-links">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="{% url 'product' %}">Products</a></li>
                    <li><a href="{% url 'selling' %}">Sell</a></li>
                    <li><a href="{% url 'my_appointment' %}">Appointment</a></li>
                </ul>
            </div>
            <div class="footer-col footer-contact">
                <h4>Contact</h4>
                <p>Address: 342 Molino Rd. Bacoor, Cavite</p>
                <p>Email: koyanardzshop@gmail.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="container">Â© {% now "Y" %} Koya Nardz â€” All rights reserved.</div>
        </div>
    </footer>

    <script>
        // Mobile nav toggle
        (function(){
            const toggle = document.querySelector('.nav-toggle');
            const nav = document.querySelector('.main-nav');
            toggle && toggle.addEventListener('click', function(){
                const expanded = this.getAttribute('aria-expanded') === 'true';
                this.setAttribute('aria-expanded', String(!expanded));
                nav.classList.toggle('open');
            });

            // Favorite dropdown / mobile redirect
            const favBtn = document.getElementById('favToggle');
            const favPanel = document.getElementById('favoriteDropdown');
            favBtn && favBtn.addEventListener('click', function(e){
                const isMobile = window.matchMedia('(max-width: 768px)').matches;
                if (isMobile) {
                    // On mobile, go to the favorites page instead of showing dropdown
                    window.location.href = "{% url 'favorite' %}";
                    return;
                }
                e.stopPropagation();
                const open = favPanel.style.display === 'block';
                favPanel.style.display = open ? 'none' : 'block';
            });

            // User dropdown toggle
            const userBtn = document.getElementById('userToggle');
            const userPanel = document.getElementById('userDropdown');
            userBtn && userBtn.addEventListener('click', function(e){
                e.stopPropagation();
                userPanel.style.display = userPanel.style.display === 'block' ? 'none' : 'block';
            });

            // Close dropdowns on outside click
            document.addEventListener('click', function(e){
                if(favPanel && !favPanel.contains(e.target) && e.target.id !== 'favToggle') favPanel.style.display = 'none';
                if(userPanel && !userPanel.contains(e.target) && e.target.id !== 'userToggle') userPanel.style.display = 'none';
            });

            // Mobile buttons that live inside the nav overlay
            const favBtnMobile = document.getElementById('favToggleMobile');
            const userBtnMobile = document.getElementById('userToggleMobile');
            favBtnMobile && favBtnMobile.addEventListener('click', function(e){
                e.stopPropagation();
                // On mobile, redirect to the favorites page
                window.location.href = "{% url 'favorite' %}";
            });
            userBtnMobile && userBtnMobile.addEventListener('click', function(e){
                e.stopPropagation();
                nav.classList.add('open');
                userPanel && (userPanel.style.display = userPanel.style.display === 'block' ? 'none' : 'block');
            });
        })();
    </script>
</body>
</html>
            